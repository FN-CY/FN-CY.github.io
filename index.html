<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ff：能不能红啊！！！！！</title>
    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #e0e0e0;
            --text-sub: #757575;
            --red: #eb4d3d; /* FN红 */
            --green: #00a854; /* FN绿 */
            --blue: #2196f3;
            --border: #333;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 950px; margin: 0 auto; } /*稍微加宽一点适应多一列*/
        
        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--text);
            font-weight: bold;
            letter-spacing: 1px;
        }

        /* 顶部看板 */
        .dashboard {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dash-item .label { color: var(--text-sub); font-size: 0.9em; margin-bottom: 5px; }
        .dash-item .val { font-size: 1.8em; font-weight: bold; }

        /* 颜色辅助 */
        .up { color: var(--red); }
        .down { color: var(--green); }
        .gray { color: var(--text-sub); }

        /* 输入区 */
        .input-area {
            background-color: var(--card);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        input {
            background: #2c2c2c; border: 1px solid #444; color: white;
            padding: 10px; border-radius: 5px; flex: 1; outline: none;
            min-width: 100px;
        }
        input:focus { border-color: var(--blue); }

        button {
            border: none; padding: 10px 20px; border-radius: 5px; 
            cursor: pointer; font-weight: bold; color: white;
        }
        .btn-add { background-color: var(--blue); }
        .btn-refresh { background-color: #333; border: 1px solid #555; }
        .btn-refresh:hover { background-color: #444; }

        /* 列表 */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: var(--text-sub); font-size: 0.9em; padding: 10px; border-bottom: 1px solid var(--border); white-space: nowrap;}
        td { padding: 15px 10px; border-bottom: 1px solid #2a2a2a; font-size: 1em; }
        
        .code-pill { 
            background: #2a2a2a; color: #888; 
            font-size: 0.75em; padding: 2px 6px; 
            border-radius: 4px; margin-left: 5px; 
        }

        .del-btn { background: none; color: #666; padding: 5px; }
        .del-btn:hover { color: var(--red); }

        .tips {
            margin-top: 30px; padding: 15px; background: #1a1a1a; 
            color: #666; font-size: 0.85em; line-height: 1.6; border-radius: 8px;
        }
        .tips code { color: #ccc; background: #333; padding: 2px 4px; border-radius: 3px; }

        #networkStatus { font-size: 0.85em; margin-top: 5px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h1>ff：能不能红啊！！！！！</h1>

    <div class="dashboard">
        <div class="dash-item">
            <div class="label">总本金</div>
            <div class="val" id="totalMoney">0.00</div>
        </div>
        <div class="dash-item">
            <div class="label">今日盈亏</div>
            <div class="val" id="totalProfit">0.00</div>
        </div>
        <div style="text-align: right;">
            <button class="btn-refresh" onclick="fetchData()">刷新数据</button>
            <div id="networkStatus" class="gray">等待操作</div>
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="inCode" placeholder="代码 (如 sh600519)">
        <input type="text" id="inName" placeholder="名称 (如 茅台)">
        <input type="number" id="inAmt" placeholder="持有金额">
        <button class="btn-add" onclick="add()">添加</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>名称</th>
                <th>本金</th> <!-- 新增本金列 -->
                <th>现价</th>
                <th>涨跌幅</th>
                <th>今日盈亏</th>
                <th style="text-align: right;">操作</th>
            </tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

    <div class="tips">
        <strong>⚡ 范宁瞎猜的：</strong><br>
        1. 沪市(A股/ETF): <code>sh</code> + 代码。例：沪深300 <code>sh000300</code>，茅台 <code>sh600519</code><br>
        2. 深市(A股/ETF): <code>sz</code> + 代码。例：创业板 <code>sz399006</code>，宁德时代 <code>sz300750</code><br>
        3. 港股: <code>hk</code> + 代码。例：腾讯 <code>hk00700</code>，美团 <code>hk03690</code><br>
        4. 美股: <code>us</code> + 代码(大写)+<code>.</code>+代码(大写)。例：特斯拉 <code>usTSLA.TSLA</code>
    </div>
</div>

<script>
    let assets = [];
    
    window.onload = () => {
        const local = localStorage.getItem('tencent_fund_v1');
        if(local) assets = JSON.parse(local);
        render();
        if(assets.length) fetchData();
    };

    function add() {
        const code = document.getElementById('inCode').value.trim();
        const name = document.getElementById('inName').value.trim();
        const amt = parseFloat(document.getElementById('inAmt').value);

        if(!code || !name || isNaN(amt)) return alert("请填全信息");
        
        if(!code.startsWith('sh') && !code.startsWith('sz') && !code.startsWith('hk') && !code.startsWith('us')) {
            alert("代码必须加前缀：sh(沪), sz(深), hk(港), us(美)\n请查看底部说明。");
            return;
        }

        assets.push({ id: Date.now(), code, name, amt, price: 0, pct: 0 });
        save(); render(); fetchData();
        
        document.getElementById('inCode').value = '';
        document.getElementById('inName').value = '';
        document.getElementById('inAmt').value = '';
    }

    function del(id) {
        assets = assets.filter(a => a.id !== id);
        save(); render();
    }

    function save() { localStorage.setItem('tencent_fund_v1', JSON.stringify(assets)); }

    function fetchData() {
        if(!assets.length) return;

        const statusDiv = document.getElementById('networkStatus');
        statusDiv.innerHTML = "正在连接腾讯云...";
        statusDiv.style.color = "#2196f3";

        const codes = assets.map(a => a.code).join(',');
        const script = document.createElement('script');
        script.charset = "gbk"; 
        script.src = `https://qt.gtimg.cn/q=${codes}&_t=${Date.now()}`;

        script.onload = () => {
            let success = 0;
            assets.forEach(a => {
                const varName = `v_${a.code.replace(/\./g, '_')}`;
                const dataStr = window[varName];

                if(dataStr) {
                    const params = dataStr.split('~');
                    if(params.length > 3) {
                        let price = 0; 
                        let pct = 0;

                        if(a.code.startsWith('us')) {
                            price = parseFloat(params[3]);
                            pct = parseFloat(params[32]); 
                        } else if(a.code.startsWith('hk')) {
                            price = parseFloat(params[3]);
                            pct = parseFloat(params[32]);
                        } else {
                            price = parseFloat(params[3]);
                            pct = parseFloat(params[32]);
                        }
                        
                        a.price = price;
                        a.pct = pct;
                        success++;
                    }
                }
            });

            render();
            statusDiv.innerHTML = `更新成功 ${new Date().toLocaleTimeString()}`;
            statusDiv.style.color = "#00a854";
            document.body.removeChild(script);
        };

        script.onerror = () => {
            statusDiv.innerHTML = "连接被拦截或断开";
            statusDiv.style.color = "#eb4d3d";
        };

        document.body.appendChild(script);
    }

    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        
        let totalM = 0;
        let totalP = 0;

        assets.forEach(a => {
            const profit = a.amt * (a.pct / 100);
            totalM += a.amt;
            totalP += profit;

            const color = a.pct > 0 ? 'up' : (a.pct < 0 ? 'down' : 'gray');
            const sign = a.pct > 0 ? '+' : '';

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>
                    <div>${a.name} <span class="code-pill">${a.code}</span></div>
                </td>
                <td>¥${a.amt.toLocaleString()}</td> <!-- 本金列数据 -->
                <td>${a.price || '-'}</td>
                <td class="${color}">${sign}${a.pct.toFixed(2)}%</td>
                <td class="${color}" style="font-weight:bold">${sign}${profit.toFixed(2)}</td>
                <td style="text-align: right;"><button class="del-btn" onclick="del(${a.id})">×</button></td>
            `;
            list.appendChild(tr);
        });

        document.getElementById('totalMoney').innerText = totalM.toLocaleString();
        const pEl = document.getElementById('totalProfit');
        pEl.innerText = (totalP > 0 ? '+' : '') + totalP.toFixed(2);
        pEl.className = 'val ' + (totalP > 0 ? 'up' : (totalP < 0 ? 'down' : 'gray'));
    }
</script>

</body>

</html>
